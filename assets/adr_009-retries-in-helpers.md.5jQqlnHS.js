import{_ as r,c as a,o as i,aj as t}from"./chunks/framework.Bbpi2Fiw.js";const h=JSON.parse('{"title":"ADR-009 Retries Live in Helpers, Core Backends are Single-Attempt","description":"","frontmatter":{},"headers":[],"relativePath":"adr/009-retries-in-helpers.md","filePath":"adr/009-retries-in-helpers.md","lastUpdated":1764705171000}'),l={name:"adr/009-retries-in-helpers.md"};function n(o,e,s,c,d,p){return i(),a("div",null,[...e[0]||(e[0]=[t('<h1 id="adr-009-retries-live-in-helpers-core-backends-are-single-attempt" tabindex="-1">ADR-009 Retries Live in Helpers, Core Backends are Single-Attempt <a class="header-anchor" href="#adr-009-retries-live-in-helpers-core-backends-are-single-attempt" aria-label="Permalink to “ADR-009 Retries Live in Helpers, Core Backends are Single-Attempt”">​</a></h1><p><strong>Status:</strong> Accepted <strong>Date:</strong> 2025-10 <strong>Tags:</strong> api-design, layering, retries</p><h2 id="problem" tabindex="-1">Problem <a class="header-anchor" href="#problem" aria-label="Permalink to “Problem”">​</a></h2><p>Users expect transparent retry on contention, but the initial spec included retry configuration in core constants, creating confusion about where retry logic lives. Backends should stay minimal and composable.</p><h2 id="decision" tabindex="-1">Decision <a class="header-anchor" href="#decision" aria-label="Permalink to “Decision”">​</a></h2><ul><li><code>lock()</code> helper handles all retry logic and is the primary export</li><li>Backends perform single-attempt operations only—no retry logic</li><li>Split constants: <code>BACKEND_DEFAULTS</code> (ttlMs) from <code>LOCK_DEFAULTS</code> (retry config)</li><li>Default strategy: exponential backoff with equal jitter (50% randomization)</li><li>Removed <code>retryAfterMs</code> field—no backends can provide meaningful hints</li></ul><h2 id="alternatives-brief" tabindex="-1">Alternatives (brief) <a class="header-anchor" href="#alternatives-brief" aria-label="Permalink to “Alternatives (brief)”">​</a></h2><ul><li>Retry in backends — mixed responsibilities, harder to customize</li><li>No retry support — poor DX for common use case</li></ul><h2 id="impact" tabindex="-1">Impact <a class="header-anchor" href="#impact" aria-label="Permalink to “Impact”">​</a></h2><ul><li>Positive: Clear layering, predictable API, composable, smaller core API</li><li>Negative/Risks: Breaking change—removed <code>retryAfterMs</code> from <code>AcquireResult</code></li></ul><h2 id="links" tabindex="-1">Links <a class="header-anchor" href="#links" aria-label="Permalink to “Links”">​</a></h2><ul><li>Code/Docs: <code>common/auto-lock.ts</code>, <code>common/constants.ts</code></li><li>Related ADRs: None</li></ul>',12)])])}const f=r(l,[["render",n]]);export{h as __pageData,f as default};
