import{_ as t,c as a,o as i,aj as r}from"./chunks/framework.Bbpi2Fiw.js";const m=JSON.parse('{"title":"ADR-010 Authoritative ExpiresAtMs from Mutations","description":"","frontmatter":{},"headers":[],"relativePath":"adr/010-authoritative-expiresat.md","filePath":"adr/010-authoritative-expiresat.md","lastUpdated":1764705171000}'),s={name:"adr/010-authoritative-expiresat.md"};function o(n,e,l,d,c,p){return i(),a("div",null,[...e[0]||(e[0]=[r('<h1 id="adr-010-authoritative-expiresatms-from-mutations" tabindex="-1">ADR-010 Authoritative ExpiresAtMs from Mutations <a class="header-anchor" href="#adr-010-authoritative-expiresatms-from-mutations" aria-label="Permalink to “ADR-010 Authoritative ExpiresAtMs from Mutations”">​</a></h1><p><strong>Status:</strong> Accepted <strong>Date:</strong> 2025-10 <strong>Tags:</strong> time, consistency, heartbeat</p><h2 id="problem" tabindex="-1">Problem <a class="header-anchor" href="#problem" aria-label="Permalink to “Problem”">​</a></h2><p>Redis acquire/extend Lua scripts returned only success indicators, forcing TypeScript to approximate <code>expiresAtMs</code> using client-side calculations (<code>Date.now() + ttlMs</code>). This created:</p><ol><li><strong>Time authority inconsistency</strong>: Redis uses server time, but expiresAtMs came from client time</li><li><strong>Heartbeat scheduling inaccuracy</strong>: Clock skew caused missed windows or wasted extensions</li></ol><h2 id="decision" tabindex="-1">Decision <a class="header-anchor" href="#decision" aria-label="Permalink to “Decision”">​</a></h2><p>All backend mutation operations (acquire, extend) MUST return authoritative <code>expiresAtMs</code> computed from the backend&#39;s designated time source—no client-side approximation permitted.</p><ul><li>Single source of truth for all timestamps</li><li>Eliminates skew-induced bugs</li><li>Enables reliable auto-extend patterns</li></ul><h2 id="alternatives-brief" tabindex="-1">Alternatives (brief) <a class="header-anchor" href="#alternatives-brief" aria-label="Permalink to “Alternatives (brief)”">​</a></h2><ul><li>Client-side approximation with buffer — still drifts, band-aids the problem</li><li>Separate getExpiry() operation — extra round-trip, doesn&#39;t solve race</li></ul><h2 id="impact" tabindex="-1">Impact <a class="header-anchor" href="#impact" aria-label="Permalink to “Impact”">​</a></h2><ul><li>Positive: Consistent timestamps, accurate heartbeat scheduling, reliable auto-extend</li><li>Negative/Risks: Trivial—8 bytes added to return payload</li></ul><h2 id="links" tabindex="-1">Links <a class="header-anchor" href="#links" aria-label="Permalink to “Links”">​</a></h2><ul><li>Code/Docs: <code>docs/specs/interface.md</code> (Time Authority), backend specs (acquire/extend sections)</li><li>Related ADRs: ADR-012 (backend restatement)</li></ul>',14)])])}const h=t(s,[["render",o]]);export{m as __pageData,h as default};
