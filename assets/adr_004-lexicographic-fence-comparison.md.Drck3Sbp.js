import{_ as i,c as a,o as r,aj as o}from"./chunks/framework.Bbpi2Fiw.js";const m=JSON.parse('{"title":"ADR-004 Lexicographic Fence Comparison","description":"","frontmatter":{},"headers":[],"relativePath":"adr/004-lexicographic-fence-comparison.md","filePath":"adr/004-lexicographic-fence-comparison.md","lastUpdated":1764705171000}'),n={name:"adr/004-lexicographic-fence-comparison.md"};function s(t,e,c,l,d,p){return r(),a("div",null,[...e[0]||(e[0]=[o('<h1 id="adr-004-lexicographic-fence-comparison" tabindex="-1">ADR-004 Lexicographic Fence Comparison <a class="header-anchor" href="#adr-004-lexicographic-fence-comparison" aria-label="Permalink to “ADR-004 Lexicographic Fence Comparison”">​</a></h1><p><strong>Status:</strong> Accepted <strong>Date:</strong> 2025-09 <strong>Tags:</strong> fence-tokens, api-design, precision</p><h2 id="problem" tabindex="-1">Problem <a class="header-anchor" href="#problem" aria-label="Permalink to “Problem”">​</a></h2><p>The original fence design claimed tokens were &quot;opaque&quot; while mandating specific formatting and comparison helpers. More critically, the initial 19-digit format created a <strong>precision safety issue</strong>: Lua numbers use IEEE 754 doubles (~53 bits precision), so fence values exceeding 2^53-1 (~9e15) would suffer precision loss, breaking monotonicity guarantees.</p><h2 id="decision" tabindex="-1">Decision <a class="header-anchor" href="#decision" aria-label="Permalink to “Decision”">​</a></h2><p>Fence tokens are <strong>fixed-width 15-digit zero-padded decimal strings with lexicographic ordering</strong>.</p><ul><li>Direct string comparison (<code>fenceA &gt; fenceB</code>) replaces helper functions</li><li>15 digits stays within Lua&#39;s 53-bit precision limit (2^53-1 ≈ 9.007e15)</li><li>10^15 capacity = ~31.7 years at 1M locks/sec</li><li>All backends return identical format for cross-backend consistency</li></ul><h2 id="alternatives-brief" tabindex="-1">Alternatives (brief) <a class="header-anchor" href="#alternatives-brief" aria-label="Permalink to “Alternatives (brief)”">​</a></h2><ul><li>19-digit format — exceeds Lua precision, breaks monotonicity</li><li>BigInt format — not JSON-safe, poor cross-language support</li><li>Variable-width strings — lexicographic comparison fails (&quot;9&quot; &gt; &quot;10&quot;)</li><li>Helper functions — unnecessary complexity when strings work natively</li></ul><h2 id="impact" tabindex="-1">Impact <a class="header-anchor" href="#impact" aria-label="Permalink to “Impact”">​</a></h2><ul><li>Positive: Simpler API, precision safety, JSON-safe, cross-language compatible</li><li>Negative/Risks: Breaking change for existing fence values (acceptable pre-1.0)</li></ul><h2 id="links" tabindex="-1">Links <a class="header-anchor" href="#links" aria-label="Permalink to “Links”">​</a></h2><ul><li>Code/Docs: <code>docs/specs/interface.md</code> (Fence Token Format), <code>common/constants.ts</code></li><li>Related ADRs: None</li></ul>',13)])])}const g=i(n,[["render",s]]);export{m as __pageData,g as default};
