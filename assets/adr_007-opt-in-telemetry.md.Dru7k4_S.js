import{_ as a,c as t,o as r,aj as i}from"./chunks/framework.Bbpi2Fiw.js";const h=JSON.parse('{"title":"ADR-007 Opt-In Telemetry","description":"","frontmatter":{},"headers":[],"relativePath":"adr/007-opt-in-telemetry.md","filePath":"adr/007-opt-in-telemetry.md","lastUpdated":1764705171000}'),o={name:"adr/007-opt-in-telemetry.md"};function n(l,e,s,c,d,p){return r(),t("div",null,[...e[0]||(e[0]=[i('<h1 id="adr-007-opt-in-telemetry" tabindex="-1">ADR-007 Opt-In Telemetry <a class="header-anchor" href="#adr-007-opt-in-telemetry" aria-label="Permalink to “ADR-007 Opt-In Telemetry”">​</a></h1><p><strong>Status:</strong> Accepted <strong>Date:</strong> 2025-09 <strong>Tags:</strong> telemetry, api-design, performance</p><h2 id="problem" tabindex="-1">Problem <a class="header-anchor" href="#problem" aria-label="Permalink to “Problem”">​</a></h2><p>Original specification mandated telemetry for all operations, requiring backends to compute hashes and emit events even when no consumer existed. This created unnecessary overhead, complicated the API with redaction policies, and made testing difficult due to side effects.</p><h2 id="decision" tabindex="-1">Decision <a class="header-anchor" href="#decision" aria-label="Permalink to “Decision”">​</a></h2><p>Make telemetry <strong>opt-in</strong> via decorator pattern:</p><ul><li>Telemetry OFF by default—backends don&#39;t compute hashes or emit events</li><li><code>withTelemetry(backend, options)</code> wraps backends to add observability</li><li><code>lookup()</code> always returns sanitized data; <code>getByKeyRaw()</code>/<code>getByIdRaw()</code> provide raw access</li><li>Async isolation—event callbacks never block operations or propagate errors</li></ul><h2 id="alternatives-brief" tabindex="-1">Alternatives (brief) <a class="header-anchor" href="#alternatives-brief" aria-label="Permalink to “Alternatives (brief)”">​</a></h2><ul><li>Mandatory telemetry — unnecessary overhead, testing complexity</li><li>Per-operation telemetry flags — API clutter, inconsistent behavior</li></ul><h2 id="impact" tabindex="-1">Impact <a class="header-anchor" href="#impact" aria-label="Permalink to “Impact”">​</a></h2><ul><li>Positive: Zero-cost abstraction, cleaner separation, better testing, tree-shakable</li><li>Negative/Risks: Breaking change—applications using <code>onEvent</code> must wrap backends</li></ul><h2 id="links" tabindex="-1">Links <a class="header-anchor" href="#links" aria-label="Permalink to “Links”">​</a></h2><ul><li>Code/Docs: <code>common/telemetry.ts</code>, <code>docs/specs/interface.md</code></li><li>Related ADRs: None</li></ul>',13)])])}const b=a(o,[["render",n]]);export{h as __pageData,b as default};
