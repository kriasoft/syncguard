import{_ as a,c as i,o,aj as t}from"./chunks/framework.Bbpi2Fiw.js";const m=JSON.parse('{"title":"ADR-016 Opt-In Disposal Timeout","description":"","frontmatter":{},"headers":[],"relativePath":"adr/016-disposal-timeout.md","filePath":"adr/016-disposal-timeout.md","lastUpdated":1764705171000}'),l={name:"adr/016-disposal-timeout.md"};function s(n,e,r,d,c,p){return o(),i("div",null,[...e[0]||(e[0]=[t('<h1 id="adr-016-opt-in-disposal-timeout" tabindex="-1">ADR-016 Opt-In Disposal Timeout <a class="header-anchor" href="#adr-016-opt-in-disposal-timeout" aria-label="Permalink to “ADR-016 Opt-In Disposal Timeout”">​</a></h1><p><strong>Status:</strong> Accepted <strong>Date:</strong> 2025-10 <strong>Tags:</strong> disposal, timeout, reliability</p><h2 id="problem" tabindex="-1">Problem <a class="header-anchor" href="#problem" aria-label="Permalink to “Problem”">​</a></h2><p><code>Symbol.asyncDispose</code> calls <code>release()</code> without timeout. If backend hangs (network latency, slow queries), disposal blocks indefinitely. Manual <code>release()</code> supports <code>AbortSignal</code>, but automatic disposal doesn&#39;t—inconsistent cancellation behavior.</p><h2 id="decision" tabindex="-1">Decision <a class="header-anchor" href="#decision" aria-label="Permalink to “Decision”">​</a></h2><p>Add <strong>opt-in</strong> <code>disposeTimeoutMs</code> configuration:</p><ul><li>Optional field in <code>BackendConfig</code> (no default)</li><li>When configured, disposal creates internal <code>AbortController</code> with timeout</li><li>Timeout errors flow through <code>onReleaseError</code> callback</li><li>Backend-agnostic—applies to Redis, PostgreSQL, Firestore</li><li>Manual <code>release()</code> unaffected—uses caller-provided signal</li></ul><h2 id="alternatives-brief" tabindex="-1">Alternatives (brief) <a class="header-anchor" href="#alternatives-brief" aria-label="Permalink to “Alternatives (brief)”">​</a></h2><ul><li>Default timeout (e.g., 5s) — might cause false timeouts</li><li>Global signal configuration — too complex, no per-lock control</li><li>Do nothing — ignores legitimate reliability concerns</li></ul><h2 id="impact" tabindex="-1">Impact <a class="header-anchor" href="#impact" aria-label="Permalink to “Impact”">​</a></h2><ul><li>Positive: Responsiveness guarantee, observable failures, defense-in-depth</li><li>Negative/Risks: None—opt-in with no default</li></ul><h2 id="links" tabindex="-1">Links <a class="header-anchor" href="#links" aria-label="Permalink to “Links”">​</a></h2><ul><li>Code/Docs: <code>common/disposable.ts</code>, <code>common/types.ts</code></li><li>Related ADRs: ADR-015 (Async RAII)</li></ul>',13)])])}const h=a(l,[["render",s]]);export{m as __pageData,h as default};
