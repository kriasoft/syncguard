import{_ as a,c as i,o,aj as s}from"./chunks/framework.Bbpi2Fiw.js";const h=JSON.parse('{"title":"ADR-015 Async RAII for Locks","description":"","frontmatter":{},"headers":[],"relativePath":"adr/015-async-raii-locks.md","filePath":"adr/015-async-raii-locks.md","lastUpdated":1764705171000}'),r={name:"adr/015-async-raii-locks.md"};function l(t,e,n,c,d,p){return o(),i("div",null,[...e[0]||(e[0]=[s('<h1 id="adr-015-async-raii-for-locks" tabindex="-1">ADR-015 Async RAII for Locks <a class="header-anchor" href="#adr-015-async-raii-for-locks" aria-label="Permalink to “ADR-015 Async RAII for Locks”">​</a></h1><p><strong>Status:</strong> Accepted <strong>Date:</strong> 2025-10 <strong>Tags:</strong> api-design, disposal, typescript</p><h2 id="problem" tabindex="-1">Problem <a class="header-anchor" href="#problem" aria-label="Permalink to “Problem”">​</a></h2><p>Lock management requires cleanup on all code paths. Manual <code>try/finally</code> is error-prone. JavaScript&#39;s <code>await using</code> (AsyncDisposable, Node.js ≥20) provides RAII for automatic cleanup, but integration required design decisions around error handling, signal propagation, and state management.</p><h2 id="decision" tabindex="-1">Decision <a class="header-anchor" href="#decision" aria-label="Permalink to “Decision”">​</a></h2><p>Integrate AsyncDisposable into all <code>acquire()</code> results:</p><ul><li>All results implement <code>Symbol.asyncDispose</code> for <code>await using</code> compatibility</li><li>Two config patterns: backend-level for <code>await using</code>, lock-level for <code>lock()</code> helper</li><li>Stateless handle design—delegate idempotency to backend</li><li>Handle methods accept optional <code>AbortSignal</code> for per-operation cancellation</li><li><code>onReleaseError</code> callback for disposal failures (disposal never throws)</li><li>Manual <code>release()</code>/<code>extend()</code> throw on system errors (consistent with backend API)</li></ul><h2 id="alternatives-brief" tabindex="-1">Alternatives (brief) <a class="header-anchor" href="#alternatives-brief" aria-label="Permalink to “Alternatives (brief)”">​</a></h2><ul><li>Separate disposable wrapper — extra API surface</li><li>Mutable released flag — race conditions, complexity</li><li>Throw from disposal — violates AsyncDisposable contract</li></ul><h2 id="impact" tabindex="-1">Impact <a class="header-anchor" href="#impact" aria-label="Permalink to “Impact”">​</a></h2><ul><li>Positive: Correctness guarantee, ergonomic API, error resilience, composable</li><li>Negative/Risks: None—additive to existing API</li></ul><h2 id="links" tabindex="-1">Links <a class="header-anchor" href="#links" aria-label="Permalink to “Links”">​</a></h2><ul><li>Code/Docs: <code>common/disposable.ts</code>, <code>docs/specs/interface.md</code> (Resource Management)</li><li>Related ADRs: ADR-016 (disposal timeout)</li></ul>',13)])])}const f=a(r,[["render",l]]);export{h as __pageData,f as default};
